<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTDMapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssm.account.mapper.RoleMapper">
	<!-- <cache type="com.ssm.util.LoggingRedisCache"></cache> -->
	<resultMap id="BaseResultMap" type="com.ssm.account.dto.Role" extends="com.ssm.mapper.BaseMapper.BaseResultMap">
		<result column="id" property="id"/>
		<result column="user_id" property="userId"/>
		<result column="role_id" property="roleId"/>
		
		<result column="role_code" property="roleCode"/>
		<result column="role_name" property="roleName"/>
		<result column="short_name" property="shortName"/>
	</resultMap>
	
	<select id="selectByUser" resultMap="BaseResultMap" parameterType="com.ssm.account.dto.User">
		select  
			ur.role_Id,
			(select role_Name from tb_role where role_Id = ur.role_Id) as roleName
		from tb_user_role ur
		<where>
			<if test="id!= null">
				and ur.user_Id =#{id}
			</if>
		</where>
	</select>
	
	<select id="selectUserRoleCount" resultMap="BaseResultMap">
        select 
        	t.role_Id,
        	(select role_Name from tb_role where role_Id = t.role_Id) as roleName
		from tb_user_role t 
		<where>
			t.user_Id = #{0} and t.role_Id = #{1}
		</where> 
    </select>
	
	<select id="selectRole" resultMap="BaseResultMap" parameterType="com.ssm.account.dto.Role">
		select * from tb_role
		<where>
			<if test="roleName !=null and roleName !=''">
				role_Name like #{roleName}
			</if>
			<if test="shortName !=null and shortName !=''">
				short_Name like #{shortName}
			</if>
		</where>
	</select>
	
	<select id="selectRoleNotUserRoles" resultMap="BaseResultMap" parameterType="com.ssm.account.dto.Role">
		SELECT 
		*
		FROM 
		tb_role r
		WHERE 
		r.role_Id 
		NOT IN (SELECT role_Id FROM tb_user_role WHERE user_Id = #{userId})
		<if test="roleName !=null and roleName !=''">
			and	r.role_Name like #{roleName}
		</if>
	</select>
</mapper>